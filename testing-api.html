<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Testing API</title>
  </head>
  <body>
    <h1>News Summariser</h1>
    <ul class="article-summary">Article summary</ul>
    <ul class="news-list">News List</ul>

    <script>
      const endpoint = "http://content.guardianapis.com/search?show-fields=all&api-key=test"
      const newsList = document.querySelector(".news-list")
      const articleSummary = document.querySelector(".article-summary")
      var articles

      fetch(endpoint)
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        displayNewsList(data);
      })

      function displayNewsList(data) {
        articles = data.response.results;
        var html = "";
        for (var i=0; i < articles.length; i++) {
          var article = articles[i]
          html += `
            <li>
              <a href="#${article.webUrl}">
                <ul class="article">
                  <li>${article.webTitle}</li>
                  <li><img src="${article.fields.thumbnail}" alt="" style=""></li>
                  <li class="summary-${i}"></li>
                </ul>
              </a>
            </li>
          `
        }
        newsList.innerHTML = html;
      }

      makeUrlChangeShowArticleSummary()

      function makeUrlChangeShowArticleSummary() {
        window.addEventListener("hashchange", getSummary)
      }

      function getSummary() {
        var endpoint = summaryEndpoint(getArticleUrl(window.location));
        fetch(endpoint)
        .then(function(blob) {
          return blob.json();
        })
        .then(function(data) {
          displaySummary(data)
        })
      }

      function summaryEndpoint(url) {
        return "http://news-summary-api.herokuapp.com/aylien?apiRequestUrl=https://api.aylien.com/api/v1/summarize?url=" + url;
      }

      function getArticleUrl(location) {
        return location.hash.split("#")[1];
      }

      function displaySummary(data) {
        var html = "";
        var sentences = data.sentences;
        for (var i=0; i<sentences.length; i++) {
          html += `<li>${sentences[i]}</li>`
        }
        var articleSummary = document.querySelector(".summary-1")
        articleSummary.innerHTML = html;
      }

    </script>
  </body>
</html>
